FROM python:3.11

COPY python_shared/ /app/python_shared
COPY django-backend/ /app/django-backend

WORKDIR /app/django-backend/centro_medico

RUN pip install --no-cache-dir -r requirements.txt

EXPOSE 8000

ARG DEBUG
ARG SECRET_KEY
ARG DATABASE_URL
ARG FRONTEND_URL
ARG LANDING_URL
ARG BACKEND_URL
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_STORAGE_BUCKET_NAME
ARG AWS_S3_ENDPOINT_URL
ARG RUN_TASKS
ARG OCCUPANCY_RECORD_INTERVAL

ENV DEBUG=$DEBUG
ENV SECRET_KEY=$SECRET_KEY
ENV DATABASE_URL=$DATABASE_URL
ENV FRONTEND_URL=$FRONTEND_URL
ENV LANDING_URL=$LANDING_URL
ENV BACKEND_URL=$BACKEND_URL
ENV AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
ENV AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
ENV AWS_STORAGE_BUCKET_NAME=$AWS_STORAGE_BUCKET_NAME
ENV AWS_S3_ENDPOINT_URL=$AWS_S3_ENDPOINT_URL
ENV RUN_TASKS=$RUN_TASKS
ENV OCCUPANCY_RECORD_INTERVAL=$OCCUPANCY_RECORD_INTERVAL

CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]
